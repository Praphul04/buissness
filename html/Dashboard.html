<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Manage Reviews</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.5/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="Dashboard.css">
    <link rel="stylesheet" href="Styles.css">
    <style></style>
</head>

<body>
    <header class="header-navbar">
        <div class="container d-flex justify-content-between align-items-center py-3">
            <div class="logo-container">
                <a href="Review.html">
                    <img src="company.jpg" alt="Business Logo" class="logo img-fluid">
                </a>
            </div>

            <div class="header-content text-center flex-grow-1 mx-3">
                <h1 class="business-name">Business Dashboard</h1>
                <p class="tagline">Review and Feedback Insights</p>
            </div>

            <nav class="navbar navbar-expand-lg navbar-light">
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                    aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="collapse navbar-collapse" id="navbarNav">
                    <div class="tab-container d-flex justify-content-center">
                        <button class="tab-button active" data-text="Home" data-href="review.html">
                            <i class="bi bi-house-door" style="font-size: 1.5rem;"></i>
                        </button>
                        <button class="tab-button" data-text="Dashboard" data-href="dashboard.html">
                            <i class="bi bi-speedometer2" style="font-size: 1.5rem;"></i>
                        </button>
                        <button class="tab-button" data-text="Profile" data-href="profile.html">
                            <i class="bi bi-person" style="font-size: 1.5rem;"></i>
                        </button>
                        <button class="tab-button" data-text="Logout" data-href="login.html">
                            <i class="bi bi-box-arrow-right" style="font-size: 1.5rem;"></i>
                        </button>
                    </div>
                </div>
            </nav>
        </div>
    </header>

    <div class="container my-5">
        <section class="statistics-section py-5">
            <div class="container">
                <h2 class="text-center mb-5">Review Statistics</h2>
                <div class="row justify-content-center">
                    <div class="col-md-4 mb-4">
                        <div class="stat-card text-center p-4">
                            <div class="stat-icon mb-3">
                                <i class="bi bi-people-fill text-info"></i>
                            </div>
                            <h6 class="stat-title">Total Reviews</h6>
                            <p class="stat-value" id="total-reviews">0</p>
                        </div>
                    </div>
                    <div class="col-md-4 mb-4">
                        <div class="stat-card text-center p-4">
                            <div class="stat-icon mb-3">
                                <i class="bi bi-star-fill text-warning"></i>
                            </div>
                            <h6 class="stat-title">Average Rating</h6>
                            <p class="stat-value" id="average-rating">0.0 / 5</p>
                        </div>
                    </div>
                    <div class="col-md-4 mb-4">
                        <div class="stat-card text-center p-4">
                            <div class="stat-icon mb-3">
                                <i class="bi bi-hand-thumbs-up-fill text-success"></i>
                            </div>
                            <h6 class="stat-title">Positive Reviews</h6>
                            <p class="stat-value" id="positive-reviews">0</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="date-filter-section mb-5">
            <h2 class="text-center mb-4">Filter Reviews by Date</h2>

            <div class="d-flex justify-content-center mb-4">
                <button class="btn btn-outline-secondary mx-2 quick-filter-button" id="all-reviews-filter">All Reviews</button>
                <button class="btn btn-outline-secondary mx-2 quick-filter-button" id="today-filter">Today</button>
                <button class="btn btn-outline-secondary mx-2 quick-filter-button" id="yesterday-filter">Yesterday</button>
                <button class="btn btn-outline-secondary mx-2 quick-filter-button" id="last-week-filter">Last Week</button>
                <button class="btn btn-outline-secondary mx-2 quick-filter-button" id="last-month-filter">Last Month</button>
            </div>
        </section>

        <section class="review-management-section">
            <h2 class="text-center mb-4">Manage Reviews</h2>
            <div id="review-list" class="row">
            </div>
        </section>
    </div>

    <footer class="footer-section text-center py-5">
        <div class="container">
            <p class="footer-contact">
                For further assistance, contact us at
                <a href="mailto:support@business.com" class="footer-link">support@business.com</a>
            </p>
            <div class="social-icons my-4">
                <a href="#" class="social-icon" aria-label="Facebook"><i class="bi bi-facebook"></i></a>
                <a href="#" class="social-icon" aria-label="Twitter"><i class="bi bi-twitter"></i></a>
                <a href="#" class="social-icon" aria-label="LinkedIn"><i class="bi bi-linkedin"></i></a>
            </div>
            <p class="footer-policy">
                <a href="#" class="footer-link">Terms and Conditions</a> |
                <a href="#" class="footer-link">Privacy Policy</a>
            </p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const reviewList = document.getElementById('review-list');
            const totalReviewsElem = document.getElementById('total-reviews');
            const averageRatingElem = document.getElementById('average-rating');
            const positiveReviewsElem = document.getElementById('positive-reviews');
            const todayFilter = document.getElementById('today-filter');
            const yesterdayFilter = document.getElementById('yesterday-filter');
            const lastWeekFilter = document.getElementById('last-week-filter');
            const lastMonthFilter = document.getElementById('last-month-filter');
            const allReviewsFilter = document.getElementById('all-reviews-filter');
        
            // Fetch reviews from localStorage
            function fetchReviews() {
                return JSON.parse(localStorage.getItem('reviews')) || [];
            }
        
          // Load profile information from localStorage
document.addEventListener("DOMContentLoaded", () => {
    loadProfile();
});

// Display reviews on the page
function displayReviews(reviews) {
    reviewList.innerHTML = '';

    // Retrieve the profile picture of the logged-in user from localStorage
    const loggedInProfilePic = localStorage.getItem('profilePic') || 'https://via.placeholder.com/90';

    reviews.forEach(review => {
        const card = document.createElement('div');
        card.classList.add('col-md-4');

        // Use the review's profilePicture or fallback to logged-in user's profile picture if available
        const profilePicture = review.profilePicture || loggedInProfilePic;

        card.innerHTML = `
            <div class="ClientReview_Card">
                <div class="ClientReview_Top">
                    <div class="ClientReview_Pfp">
                        <img src="${profilePicture}" alt="Profile Picture">
                    </div>
                    <div class="ClientReview_Stars">
                        ${'★'.repeat(review.rating)}${'☆'.repeat(5 - review.rating)}
                    </div>
                </div>
                <div class="ClientReview_Body">
                    "${review.review || 'No review provided'}"
                </div>
                <div class="ClientReview_Name">
                    — ${review.name || 'Anonymous'}
                </div>
                <div class="ClientReview_Img">
                    <img src="${review.logo || 'https://via.placeholder.com/100'}" alt="Logo">
                </div>
            </div>
        `;
        reviewList.appendChild(card);
    });
    updateStatistics(reviews);
}

        
            // Update statistics
            function updateStatistics(reviews) {
                if (reviews.length === 0) {
                    totalReviewsElem.textContent = '0';
                    averageRatingElem.textContent = '0.0 / 5';
                    positiveReviewsElem.textContent = '0';
                    return;
                }
                const totalReviews = reviews.length;
                const totalRating = reviews.reduce((acc, review) => acc + review.rating, 0);
                const positiveReviews = reviews.filter(review => review.rating >= 4).length;
        
                totalReviewsElem.textContent = totalReviews;
                averageRatingElem.textContent = (totalRating / totalReviews).toFixed(1) + ' / 5';
                positiveReviewsElem.textContent = positiveReviews;
            }
        
            // Filter reviews based on date range
            function filterReviews(startDate, endDate) {
                const reviews = fetchReviews();
                console.log('Filtering reviews from', startDate, 'to', endDate); // Debugging
                const filteredReviews = reviews.filter(review => {
                    const reviewDate = new Date(review.date);
                    console.log('Review date:', reviewDate); // Debugging
                    return reviewDate >= startDate && reviewDate <= endDate;
                });
                console.log('Filtered reviews:', filteredReviews); // Debugging
                displayReviews(filteredReviews);
            }
        
            // Event listeners for quick filters
            todayFilter.addEventListener('click', () => {
                const today = new Date();
                const startDate = new Date(today.getFullYear(), today.getMonth(), today.getDate());
                const endDate = new Date(today.getFullYear(), today.getMonth(), today.getDate(), 23, 59, 59, 999);
                filterReviews(startDate, endDate);
            });
        
            yesterdayFilter.addEventListener('click', () => {
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                const startDate = new Date(yesterday.getFullYear(), yesterday.getMonth(), yesterday.getDate());
                const endDate = new Date(yesterday.getFullYear(), yesterday.getMonth(), yesterday.getDate(), 23, 59, 59, 999);
                filterReviews(startDate, endDate);
            });
        
            lastWeekFilter.addEventListener('click', () => {
                const today = new Date();
                const lastWeek = new Date();
                lastWeek.setDate(today.getDate() - 7);
                const startDate = new Date(lastWeek.getFullYear(), lastWeek.getMonth(), lastWeek.getDate());
                const endDate = new Date(today.getFullYear(), today.getMonth(), today.getDate(), 23, 59, 59, 999);
                filterReviews(startDate, endDate);
            });
        
            lastMonthFilter.addEventListener('click', () => {
                const today = new Date();
                const lastMonth = new Date();
                lastMonth.setMonth(today.getMonth() - 1);
                const startDate = new Date(lastMonth.getFullYear(), lastMonth.getMonth(), 1);
                const endDate = new Date(today.getFullYear(), today.getMonth(), today.getDate(), 23, 59, 59, 999);
                filterReviews(startDate, endDate);
            });
        
            allReviewsFilter.addEventListener('click', () => {
                displayReviews(fetchReviews());
            });
        
            // Initial fetch and display
            displayReviews(fetchReviews());
        });
        
        

        document.addEventListener("DOMContentLoaded", function() {
            const buttons = document.querySelectorAll('.tab-button');
            
            // Function to set the active button
            function setActiveButton(button) {
                buttons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
            }
        
            // Event for clicking to set the active button and navigate
            buttons.forEach(button => {
                button.addEventListener('click', () => {
                    setActiveButton(button);
                    navigateToPage(button.getAttribute('data-href'));
                });
            });
        
            // Set the initial active button based on the current page
            const currentPage = window.location.pathname.split('/').pop();
            buttons.forEach(button => {
                if (button.getAttribute('data-href') === currentPage) {
                    setActiveButton(button);
                }
            });
        });
        
        function navigateToPage(page) {
            window.location.href = page;
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            const navbarToggler = document.querySelector('.navbar-toggler');
            const navbarCollapse = document.querySelector('#navbarNav');
            const body = document.querySelector('body');
        
            // Toggle the menu
            navbarToggler.addEventListener('click', () => {
                navbarCollapse.classList.toggle('show');
            });
        
            // Close the menu when clicking outside of it
            document.addEventListener('click', (event) => {
                if (!navbarToggler.contains(event.target) && !navbarCollapse.contains(event.target)) {
                    navbarCollapse.classList.remove('show');
                }
            });
        });
        
    </script>
</body>

</html>
